<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Cart • UniThrift</title>

  <!-- SEO meta tags -->
  <meta name="description" content="UniThrift is a student marketplace for buying and selling preloved items safely near your campus.">
  <meta name="keywords" content="UniThrift, student marketplace, preloved items, Ateneo, campus shop">
  <meta name="author" content="Group 3 - UniThrift">

  <!-- Open Graph -->
  <meta property="og:title" content="UniThrift – Cart">
  <meta property="og:description" content="Review your cart before checkout.">
  <meta property="og:image" content="https://unithrift.netlify.app/preview.png">
  <meta property="og:url" content="https://unithrift.netlify.app/cart.html">

  <!-- Mobile-friendly -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="styles.css">
  <style>
    .row{display:flex;justify-content:space-between;border-bottom:1px solid #eee;padding:8px 0}
    .muted{color:#6b7280}
    .btn{display:inline-block;background:#111827;color:#fff;padding:10px 14px;border-radius:8px;text-decoration:none}
  </style>
</head>
<body>
  <header style="padding:12px 16px;background:#fff;border-bottom:1px solid #eee">
    <a href="index.html">← Continue shopping</a>
  </header>

  <main style="max-width:800px;margin:16px auto;padding:0 16px">
    <h1>Your Cart</h1>
    <div id="list"></div>
    <h3 id="total" class="muted"></h3>
    <a href="checkout.html" class="btn">Checkout</a>
  </main>

  <script>
    // --- Helpers ---
    const peso = n => "₱" + (Number(n)||0).toLocaleString("en-PH",{maximumFractionDigits:0});

    function readRawCart() {
      try { return JSON.parse(localStorage.getItem("cart") || "[]"); }
      catch { return []; }
    }

    // Normalize any shape -> { id, name, price:number, qty:number }
    function normalizeCart(raw) {
      return raw.map(i => {
        const qty = Number(i.qty ?? i.quantity ?? 0);
        const price = Number(i.price ?? i.unitPrice ?? 0);
        return { ...i, qty, price };
      });
    }

    function saveCart(cart) {
      localStorage.setItem("cart", JSON.stringify(cart));
    }

    function loadCart() {
      const normalized = normalizeCart(readRawCart());
      // persist normalized shape so checkout sees qty (not quantity)
      saveCart(normalized);
      return normalized;
    }

    function render() {
      const cart = loadCart();
      const list = document.getElementById("list");
      let total = 0;

      if (!cart.length) {
        list.innerHTML = "<p>Your cart is empty.</p>";
        document.getElementById("total").textContent = "Total: ₱0";
        return;
      }

      list.innerHTML = cart.map((i, idx) => {
        const sub = i.price * i.qty;
        total += sub;
        return `
          <div class="row">
            <div>${i.name} × ${i.qty}</div>
            <div>${peso(sub)}</div>
          </div>
        `;
      }).join("");

      document.getElementById("total").textContent = `Total: ${peso(total)}`;
    }

    render();
  </script>
</body>
</html>
